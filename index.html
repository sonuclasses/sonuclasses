<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2E7D32">
    <title>Sonu Classes - Home</title>
    <style>
        :root { --primary-green: #2E7D32; --primary-blue: #1976D2; --bg-light: #f4f4f9; --text-color: #333; --box-bg: white; --border-color: #ddd; }
        body.dark-mode { --bg-light: #121212; --text-color: #f1f1f1; --box-bg: #1e1e1e; --border-color: #444; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-light); color: var(--text-color); margin: 0; padding: 0; text-align: center; transition: background-color 0.3s, color 0.3s; }
        header { background-color: var(--primary-green); color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        h1 { margin: 0; font-size: 20px; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .theme-toggle { background: none; border: none; font-size: 24px; cursor: pointer; color: white; padding: 0; margin: 0; }
        .profile-section { position: relative; }
        .profile-img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; cursor: pointer; object-fit: cover; background: #fff; }
        .dropdown { display: none; position: absolute; right: 0; top: 55px; background: var(--box-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.2); border-radius: 10px; min-width: 160px; z-index: 100; overflow: hidden; border: 1px solid var(--border-color); text-align: left; }
        .dropdown button { width: 100%; padding: 12px; border: none; background: none; color: var(--text-color); cursor: pointer; font-weight: bold; text-align: left; }
        .dropdown button:hover { background: var(--bg-light); }
        .btn-logout { color: #ff5252 !important; border-top: 1px solid var(--border-color) !important; }

        .news-ticker { background-color: var(--primary-blue); color: white; padding: 10px; overflow: hidden; white-space: nowrap; cursor: pointer; font-weight: bold; height: 25px; display: flex; align-items: center; }
        .news-ticker span { display: inline-block; white-space: nowrap; animation: marquee 30s linear infinite; padding-left: 100%; font-size: 15px; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .hero-section { display: flex; flex-wrap: wrap-reverse; align-items: center; justify-content: center; padding: 30px 20px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); margin: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        body.dark-mode .hero-section { background: linear-gradient(135deg, #1b5e20 0%, #003300 100%); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .hero-text { flex: 1; min-width: 250px; text-align: left; padding: 10px; }
        .hero-text p.welcome-msg { font-size: 16px; font-weight: bold; color: #555; margin-bottom: 5px; }
        body.dark-mode .hero-text p.welcome-msg { color: #ccc; }
        .hero-text h2 { font-size: 28px; margin-top: 0; color: var(--primary-blue); line-height: 1.3; }
        body.dark-mode .hero-text h2 { color: #64B5F6; }
        .hero-text p.sub-text { font-size: 15px; color: #444; line-height: 1.5; margin-bottom: 15px; }
        body.dark-mode .hero-text p.sub-text { color: #ddd; }
        .hero-btn { background: var(--primary-green); color: white; padding: 12px 25px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: 0.3s; }
        
        #installAppBtn { display: none; background: #D50000; color: white; padding: 15px; border: none; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); margin: 20px auto; width: 250px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* ‡§®‡§Ø‡§æ ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§¨‡§ü‡§® */
        #notifyBtn { background: #00ACC1; color: white; padding: 12px 20px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2); margin: 10px auto; display: block; }

        .class-btn { display: inline-block; width: 140px; padding: 15px; margin: 10px; background: var(--primary-blue); color: white; text-decoration: none; border-radius: 10px; font-weight: bold; transition: transform 0.2s, background 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .class-btn:active { transform: scale(0.9); background: #1565C0; }
        .action-btn { display: block; width: 250px; margin: 15px auto; padding: 15px; border: none; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s; }
        .btn-quiz { background: #FFD600; color: #333; }
        .btn-leaderboard { background: #FF9800; color: white; }
        
        .whatsapp-float { position: fixed; width: 60px; height: 60px; bottom: 20px; right: 20px; background-color: #25d366; color: #FFF; border-radius: 50px; text-align: center; font-size: 35px; box-shadow: 0px 4px 10px rgba(0,0,0,0.3); z-index: 1000; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: transform 0.3s; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: var(--box-bg); color: var(--text-color); padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; max-height: 85vh; overflow-y: auto; position: relative; text-align: left; border: 1px solid var(--border-color); }
        .close-btn { background: #333; color: white; border: none; padding: 12px 20px; border-radius: 5px; margin-top: 20px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; text-align: center; }
        .submit-quiz-btn { background: var(--primary-green); color: white; border: none; padding: 12px 20px; border-radius: 5px; margin-top: 10px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .q-block h4 { margin-top: 0; font-size: 17px; line-height: 1.4; color: var(--primary-blue); }
        .option-btn { width: 100%; padding: 12px; margin: 6px 0; border: 2px solid var(--border-color); border-radius: 8px; background: var(--box-bg); color: var(--text-color); cursor: pointer; font-weight: bold; transition: 0.3s; text-align: left; font-size: 15px;}
        .option-btn:disabled { opacity: 0.8; cursor: not-allowed; }
        .correct { background-color: #4CAF50 !important; color: white !important; border-color: #2E7D32 !important; }
        .wrong { background-color: #F44336 !important; color: white !important; border-color: #B71C1C !important; }
        .leaderboard-list { list-style: none; padding: 0; margin: 0; }
        .leaderboard-list li { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 16px; font-weight: bold; display: flex; justify-content: space-between; }
        .leaderboard-list li:last-child { border-bottom: none; }
        .show { display: flex !important; }
        footer { margin-top: 30px; padding: 15px; background: var(--box-bg); border-top: 1px solid var(--border-color); font-size: 14px; color: #666; }
    </style>
</head>
<body style="display: none;" id="main-body">

<header>
    <h1>Sonu Classes</h1>
    <div class="header-right">
        <button class="theme-toggle" id="theme-btn" onclick="toggleTheme()">üåô</button>
        <div class="profile-section">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" id="user-photo" class="profile-img" onclick="toggleDropdown()">
            <div id="dropdown-menu" class="dropdown">
                <button onclick="document.getElementById('photo-input').click()">üì∑ ‡§´‡•ã‡§ü‡•ã ‡§¨‡§¶‡§≤‡•á‡§Ç</button>
                <button onclick="confirmLogout()" class="btn-logout">üö™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
                <input type="file" id="photo-input" style="display:none" accept="image/*" onchange="changePhoto(event)">
            </div>
        </div>
    </div>
</header>

<div class="news-ticker" onclick="showModal('news-modal')">
    <span id="news-text-display">üì¢ ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à... üì¢</span>
</div>

<div class="hero-section">
    <div class="hero-text">
        <p class="welcome-msg">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, <span id="student-name" style="color: var(--primary-green);">‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó...</span></p>
        <h2>Welcome to <br><span style="color: var(--primary-blue);">Sonu Classes</span></h2>
        <p class="sub-text">10‡§µ‡•Ä‡§Ç ‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ 2027 ‡§î‡§∞ IAS ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡•ç‡§∞‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§è‡§µ‡§Ç ‡§∏‡§∞‡•ç‡§µ‡§∂‡•ç‡§∞‡•á‡§∑‡•ç‡§† ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º‡•§</p>
        <button class="hero-btn" onclick="showModal('notes-modal')">üìö ‡§™‡§¢‡§º‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
    <div class="hero-image">
        <img src="Screenshot_2026-02-20-17-10-57-613_com.google.android.googlequicksearchbox.jpg" alt="Sonu Classes Logo" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; box-shadow: 0 4px 15px rgba(0,0,0,0.2); animation: float 3s ease-in-out infinite;">
    </div>
</div>

<button id="notifyBtn" onclick="enableNotifications()">üîî ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
<button id="installAppBtn">üì≤ App ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</button>

<div class="container" style="margin-bottom: 20px;">
    <a href="#" class="class-btn">Class 8</a>
    <a href="#" class="class-btn">Class 9</a>
    <a href="class10.html" class="class-btn">Class 10</a>
</div>

<button class="action-btn btn-quiz" onclick="startQuiz()">üìù ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§ü‡•á‡§∏‡•ç‡§ü ‡§¶‡•á‡§Ç</button>
<button class="action-btn btn-leaderboard" onclick="showModal('leaderboard-modal')">üèÜ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ‡•á‡§Ç</button>

<a href="https://wa.me/918521057039?text=‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§∏‡•ã‡§®‡•Ç ‡§∏‡§∞, ‡§Æ‡•Å‡§ù‡•á ‡§Ü‡§™‡§ï‡•Ä ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü ‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è‡•§" target="_blank" class="whatsapp-float">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" style="width: 35px; height: 35px;">
</a>

<div id="quiz-modal" class="modal">
    <div class="modal-content" id="quiz-container">
        <h2 style="color: #E65100; text-align: center; margin-top: 0;">üìù ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§ü‡•á‡§∏‡•ç‡§ü</h2>
        <div id="quiz-area" class="q-block">
            <h4 id="quiz-q">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</h4>
            <button class="option-btn" id="btn-opt-a" onclick="checkAnswer('A')">A.</button>
            <button class="option-btn" id="btn-opt-b" onclick="checkAnswer('B')">B.</button>
            <button class="option-btn" id="btn-opt-c" onclick="checkAnswer('C')">C.</button>
            <button class="option-btn" id="btn-opt-d" onclick="checkAnswer('D')">D.</button>
            <div style="text-align: right; margin-top: 15px;">
                <button id="next-btn" style="display:none; background: #1976D2; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 15px;" onclick="nextQuestion()">‡§Ö‡§ó‡§≤‡§æ ‡§∏‡§µ‡§æ‡§≤ ‚û°Ô∏è</button>
            </div>
        </div>
        <div id="quiz-result-area" style="display: none; text-align: center; padding: 20px 0;">
            <h3 style="color: #2E7D32; font-size: 24px; margin-top: 0;">üéâ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü!</h3>
            <p style="font-size: 18px; font-weight: bold;">‡§Ü‡§™‡§ï‡§æ ‡§ï‡•Å‡§≤ ‡§∏‡•ç‡§ï‡•ã‡§∞:</p>
            <div style="font-size: 40px; font-weight: bold; color: #E65100; margin: 10px 0;"><span id="final-score-text">0</span> ‡§Ö‡§Ç‡§ï</div>
            <button class="submit-quiz-btn" onclick="submitQuiz()">‚úÖ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
        <button class="close-btn" onclick="hideModal('quiz-modal')">üö™ ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç</button>
    </div>
</div>

<div id="leaderboard-modal" class="modal">
    <div class="modal-content">
        <h2 style="color: #FF9800; text-align: center; margin-top: 0;">üèÜ ‡§ü‡•â‡§™ ‡§∏‡•ç‡§ï‡•ã‡§∞‡§∞‡•ç‡§∏</h2>
        <ul id="leaderboard-list" class="leaderboard-list">
            <li style="justify-content: center; color: gray;">‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</li>
        </ul>
        <button class="close-btn" onclick="hideModal('leaderboard-modal')">üö™ ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç</button>
    </div>
</div>

<div id="news-modal" class="modal">
    <div class="modal-content">
        <h2 style="color: var(--primary-blue); text-align: center;">‡§Ü‡§ú ‡§ï‡•Ä ‡§¨‡§°‡§º‡•Ä ‡§ñ‡§¨‡§∞‡•á‡§Ç</h2>
        <p id="news-modal-text" style="line-height: 1.8; font-size: 15px;">‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä...</p>
        <button class="close-btn" onclick="hideModal('news-modal')">üö™ ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç</button>
    </div>
</div>

<div id="notes-modal" class="modal">
    <div class="modal-content">
        <h2 style="color: #4CAF50; text-align: center; margin-top: 0;">üìö ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏</h2>
        <p>‡§Ö‡§∏‡§≤‡•Ä ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§™‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è 'Class 10' ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç.</p>
        <button class="close-btn" onclick="hideModal('notes-modal')">üö™ ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç</button>
    </div>
</div>

<footer>
    <strong>Owner & Founder: Sonu Kumar</strong><br>
    Mission: Education for All | Target: IAS
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
  import { getDatabase, ref, set, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
  import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDCzAhpQonWiNDtWmyox5QdPd4xRbpOy30",
    authDomain: "sonuclasses-b19db.firebaseapp.com",
    databaseURL: "https://sonuclasses-b19db-default-rtdb.firebaseio.com",
    projectId: "sonuclasses-b19db",
    storageBucket: "sonuclasses-b19db.firebasestorage.app",
    messagingSenderId: "166740602272",
    appId: "1:166740602272:web:af9131ad8c5e4c8fca08c5"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  const messaging = getMessaging(app);

  let currentStudentName = "Student";
  let myScore = 0;
  let questionsList = [];
  let currentQIndex = 0;
  let currentCorrectAnswer = "A"; 

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('main-body').style.display = "block";
      currentStudentName = user.displayName || user.email.split('@')[0];
      document.getElementById('student-name').innerText = currentStudentName;
      if(user.photoURL) document.getElementById('user-photo').src = user.photoURL;
      
      // ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§™‡§∞‡§Æ‡§ø‡§∂‡§® ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•Ä ‡§π‡•Å‡§à ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
      if (Notification.permission === 'granted') {
          document.getElementById('notifyBtn').style.display = 'none';
      }
    } else {
      window.location.replace("login.html");
    }
  });

  // ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§ú‡§æ‡§¶‡•Ç
  window.enableNotifications = () => {
      Notification.requestPermission().then((permission) => {
          if (permission === 'granted') {
              getToken(messaging, { vapidKey: 'BDyAN1nRFqGA7lqM7rs93-AykFTsvE-d1ocxmE6IYPqfWT2839QucicsJ43LgiGdUBGi-CaJtZOcmDHuW7FR1Ow' })
              .then((currentToken) => {
                  if (currentToken) {
                      const user = auth.currentUser;
                      if(user) set(ref(db, 'fcmTokens/' + user.uid), currentToken);
                      alert("üîî ‡§¨‡§π‡•Å‡§§ ‡§¨‡•ù‡§ø‡§Ø‡§æ! ‡§Ö‡§¨ ‡§Ü‡§™‡§ï‡•ã ‡§®‡§è ‡§ü‡•á‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§ï‡•á ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Æ‡§ø‡§≤‡§æ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á!");
                      document.getElementById('notifyBtn').style.display = 'none';
                  }
              }).catch((err) => console.log('Token Error:', err));
          } else {
              alert("‚ö†Ô∏è ‡§Ü‡§™‡§®‡•á ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§¨‡•ç‡§≤‡•â‡§ï ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡•á ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•ç‡§∞‡§æ‡§â‡•õ‡§∞ ‡§ï‡•Ä ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§Å‡•§");
          }
      });
  };

  onMessage(messaging, (payload) => {
      alert("üîî ‡§®‡§à ‡§∏‡•Ç‡§ö‡§®‡§æ: \n" + payload.notification.title + "\n" + payload.notification.body);
  });

  window.toggleDropdown = () => document.getElementById('dropdown-menu').classList.toggle('show');
  window.showModal = (id) => document.getElementById(id).classList.add('show');
  window.hideModal = (id) => document.getElementById(id).classList.remove('show');
  window.confirmLogout = () => { if(confirm("‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) { signOut(auth).then(() => window.location.replace("login.html")); } };

  if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log("Service Worker Registered"));
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; document.getElementById('installAppBtn').style.display = 'block';
  });

  document.getElementById('installAppBtn').addEventListener('click', async () => {
      if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') { document.getElementById('installAppBtn').style.display = 'none'; }
          deferredPrompt = null;
      }
  });

  const newsRef = ref(db, 'appData/news');
  onValue(newsRef, (snapshot) => {
      if(snapshot.val()) {
          document.getElementById('news-text-display').innerText = "üì¢ " + snapshot.val().replace(/\n/g, " | ") + " üì¢";
          document.getElementById('news-modal-text').innerText = snapshot.val();
      }
  });

  const quizRef = ref(db, 'appData/quizzes');
  onValue(quizRef, (snapshot) => {
      questionsList = [];
      if(snapshot.exists()) { snapshot.forEach((child) => questionsList.push(child.val())); }
  });

  window.startQuiz = () => {
      myScore = 0; currentQIndex = 0;
      document.getElementById('quiz-area').style.display = 'block';
      document.getElementById('quiz-result-area').style.display = 'none';
      showModal('quiz-modal'); loadQuestion();
  };

  window.loadQuestion = () => {
      if(questionsList.length === 0) {
          document.getElementById('quiz-q').innerText = "üöß ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
          ['btn-opt-a', 'btn-opt-b', 'btn-opt-c', 'btn-opt-d'].forEach(id => document.getElementById(id).style.display = 'none');
          return;
      }
      const data = questionsList[currentQIndex];
      document.getElementById('quiz-q').innerText = `‡§∏‡§µ‡§æ‡§≤ ${currentQIndex + 1}/${questionsList.length}: ${data.question}`;
      
      const btnA = document.getElementById('btn-opt-a'); const btnB = document.getElementById('btn-opt-b');
      const btnC = document.getElementById('btn-opt-c'); const btnD = document.getElementById('btn-opt-d');

      btnA.innerText = "A. " + data.optionA; btnB.innerText = "B. " + data.optionB;
      if(data.optionC) { btnC.innerText = "C. " + data.optionC; btnC.style.display = 'block'; } else { btnC.style.display = 'none'; }
      if(data.optionD) { btnD.innerText = "D. " + data.optionD; btnD.style.display = 'block'; } else { btnD.style.display = 'none'; }

      [btnA, btnB, btnC, btnD].forEach(b => { b.className = "option-btn"; b.disabled = false; if(b.innerText !== "C." && b.innerText !== "D.") b.style.display = 'block'; });
      currentCorrectAnswer = data.answer; document.getElementById('next-btn').style.display = 'none';
  };

  window.checkAnswer = (selectedOption) => {
      let btn = document.getElementById('btn-opt-' + selectedOption.toLowerCase());
      if(selectedOption === currentCorrectAnswer) { btn.classList.add('correct'); myScore += 10; } 
      else { btn.classList.add('wrong'); document.getElementById('btn-opt-' + currentCorrectAnswer.toLowerCase()).classList.add('correct'); }
      
      ['btn-opt-a', 'btn-opt-b', 'btn-opt-c', 'btn-opt-d'].forEach(id => document.getElementById(id).disabled = true);
      const nextBtn = document.getElementById('next-btn');
      nextBtn.style.display = 'inline-block';
      nextBtn.innerText = (currentQIndex === questionsList.length - 1) ? "‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç üèÜ" : "‡§Ö‡§ó‡§≤‡§æ ‡§∏‡§µ‡§æ‡§≤ ‚û°Ô∏è";
  };

  window.nextQuestion = () => {
      if(currentQIndex < questionsList.length - 1) { currentQIndex++; loadQuestion(); } 
      else { document.getElementById('quiz-area').style.display = 'none'; document.getElementById('final-score-text').innerText = myScore; document.getElementById('quiz-result-area').style.display = 'block'; }
  };

  window.submitQuiz = () => {
      const user = auth.currentUser;
      if(user) {
          set(ref(db, 'leaderboard/' + user.uid), { name: currentStudentName, score: myScore })
          .then(() => { alert("üéâ ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!"); hideModal('quiz-modal'); showModal('leaderboard-modal'); });
      }
  };

  const topScoresRef = query(ref(db, 'leaderboard'), orderByChild('score'), limitToLast(10));
  onValue(topScoresRef, (snapshot) => {
      const list = document.getElementById('leaderboard-list'); list.innerHTML = ''; 
      let scores = []; snapshot.forEach((childSnapshot) => scores.push(childSnapshot.val())); scores.reverse(); 
      if(scores.length === 0) { list.innerHTML = '<li style="justify-content: center; color: gray;">‡§ï‡•ã‡§à ‡§°‡§æ‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç!</li>'; } 
      else { scores.forEach((data, index) => { let medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ'; list.innerHTML += `<li><span>${medal} ${data.name}</span> <span style="color: var(--primary-green);">${data.score} ‡§Ö‡§Ç‡§ï</span></li>`; }); }
  });

  window.changePhoto = (event) => {
    const file = event.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = (e) => { document.getElementById('user-photo').src = e.target.result; alert("‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§à ‡§π‡•à!"); };
      reader.readAsDataURL(file);
    }
  };

  window.onclick = (event) => { if (!event.target.matches('.profile-img')) { document.getElementById('dropdown-menu').classList.remove('show'); } };

  window.toggleTheme = () => {
      document.body.classList.toggle('dark-mode');
      const btn = document.getElementById('theme-btn');
      if(document.body.classList.contains('dark-mode')) { btn.innerText = '‚òÄÔ∏è'; localStorage.setItem('theme', 'dark'); } 
      else { btn.innerText = 'üåô'; localStorage.setItem('theme', 'light'); }
  };

  window.onload = () => { if(localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark-mode'); document.getElementById('theme-btn').innerText = '‚òÄÔ∏è'; } };
</script>
</body>
</html>
